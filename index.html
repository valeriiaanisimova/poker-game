<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Космический Покер</title>
  <style>
    :root {
      --space-dark: #000000; 
      --space-light: #333333; 
      --space-accent: #8a6acd; 
      --space-text: #ffffff; 
      --space-highlight: #cccccc; 
      --space-gray: #222222; 
      --space-border: rgba(255, 255, 255, 0.2); 
      --space-purple-light: rgba(138, 106, 205, 0.2); 
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Press Start 2P', 'Courier New', monospace;
    }

    body {
      background: var(--space-dark);
      color: var(--space-text);
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

 
    #starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: linear-gradient(to bottom, #000000, #0a0a0a);
    }

    .star {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      animation: twinkle var(--duration, 5s) infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% {
        opacity: 0.2;
      }
      50% {
        opacity: 1;
      }
    }

    #startScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
      text-align: center;
      background: radial-gradient(circle at center, rgba(0, 0, 0, 0.95) 0%, rgba(50, 50, 50, 0.7) 100%);
    }

    .game-title {
      font-size: 3.5rem;
      margin-bottom: 40px;
      color: var(--space-accent); 
      text-shadow: 0 0 10px rgba(138, 106, 205, 0.5), 0 0 20px rgba(138, 106, 205, 0.3);
      letter-spacing: 3px;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from {
        text-shadow: 0 0 10px rgba(138, 106, 205, 0.5), 0 0 20px rgba(138, 106, 205, 0.3);
      }
      to {
        text-shadow: 0 0 15px rgba(138, 106, 205, 0.7), 0 0 30px rgba(138, 106, 205, 0.5);
      }
    }

    .start-container {
      display: flex;
      width: 90%;
      max-width: 1200px;
      margin-top: 20px;
    }

    .start-panel {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .cat-container {
      width: 100%;
      max-width: 400px;
      height: 300px;
      background: var(--space-gray);
      border: 4px solid var(--space-accent); 
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(138, 106, 205, 0.2);
      position: relative;
    }

    .cat-image {
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
      filter: grayscale(100%) brightness(0.8) contrast(1.1);
    }

    .btn {
      background: linear-gradient(to bottom, #333333, #222222);
      color: white;
      border: none;
      padding: 15px 30px;
      margin: 10px;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 8px;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--space-border);
    }

    .btn:hover {
      background: linear-gradient(to bottom, var(--space-accent), #6a4acd);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(138, 106, 205, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    #gameScreen {
      display: none;
      height: 100vh;
      padding: 20px;
    }

    .game-header {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .timer-container {
      display: none;
      align-items: center;
      gap: 15px;
      font-size: 1.3rem;
      background: var(--space-gray);
      padding: 10px 15px;
      border-radius: 8px;
      border: 2px solid var(--space-accent); 
      box-shadow: 0 0 10px rgba(138, 106, 205, 0.2);
    }

    #timer {
      font-size: 2rem;
      color: var(--space-accent); 
      font-weight: bold;
      text-shadow: 0 0 10px rgba(138, 106, 205, 0.5);
    }

    .game-content {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 80px);
    }

    .dice-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: var(--space-gray);
      border-radius: 8px;
      border: 2px solid var(--space-accent); 
      max-height: 180px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .dice-row {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
      perspective: 1500px;
    }


    .dice-wrapper {
      width: 80px;
      height: 80px;
      position: relative;
      perspective: 1000px;
      z-index: 2;
    }

    .dice {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1s cubic-bezier(0.17, 0.67, 0.83, 0.67);
    }

    .dice.held {
      border: 3px solid var(--space-accent);
      box-shadow: 0 0 20px rgba(138, 106, 205, 0.8);
      animation: pulse 1s infinite alternate;
    }

    @keyframes pulse {
      from {
        box-shadow: 0 0 10px rgba(138, 106, 205, 0.6);
      }
      to {
        box-shadow: 0 0 25px rgba(138, 106, 205, 1);
      }
    }

    .face {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(40, 40, 40, 0.9);
      border: 2px solid var(--space-accent); 
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0;
      backface-visibility: hidden;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
    }


    .front {
      transform: translateZ(40px);
    }

    .back {
      transform: rotateY(180deg) translateZ(40px);
    }

    .right {
      transform: rotateY(90deg) translateZ(40px);
    }

    .left {
      transform: rotateY(-90deg) translateZ(40px);
    }

    .top {
      transform: rotateX(90deg) translateZ(40px);
    }

    .bottom {
      transform: rotateX(-90deg) translateZ(40px);
    }


    .face::before {
      content: "";
      display: block;
      width: 15px;
      height: 15px;
      background: white;
      border-radius: 50%;
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6);
    }

 
    .face[data-value="1"]::before {
      transform: none;
    }

    .face[data-value="2"]::before {
      transform: translate(-12px, -12px);
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6),
        24px 24px 0 0 white;
    }

    .face[data-value="3"]::before {
      transform: translate(-12px, -12px);
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6),
        24px 24px 0 0 white,
        12px 12px 0 0 white;
    }

    .face[data-value="4"]::before {
      transform: translate(-12px, -12px);
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6),
        24px 0 0 0 white,
        0 24px 0 0 white,
        24px 24px 0 0 white;
    }

    .face[data-value="5"]::before {
      transform: translate(-12px, -12px);
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6),
        24px 0 0 0 white,
        0 24px 0 0 white,
        24px 24px 0 0 white,
        12px 12px 0 0 white;
    }

    .face[data-value="6"]::before {
      transform: translate(-12px, -12px);
      box-shadow:
        0 0 5px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(200, 200, 200, 0.6),
        24px 0 0 0 white,
        0 24px 0 0 white,
        24px 24px 0 0 white,
        0 0 0 0 white,
        24px 12px 0 0 white,
        0 12px 0 0 white;
    }

    .lever-container {
      display: flex;
      align-items: center;
      gap: 20px;
      margin: 10px 0;
    }

    .lever {
      width: 50px;
      height: 100px;
      background: linear-gradient(to right, #444, #333, #222);
      border-radius: 8px;
      position: relative;
      cursor: pointer;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.7);
      transition: transform 0.3s;
      top: -130px;
      left: 400px;
      z-index: 1;    
    }

    .lever-handle {
      width: 70px;
      height: 20px;
      background: linear-gradient(to bottom, var(--space-accent), #6a4acd);
      border-radius: 4px;
      position: absolute;
      top: 15px;
      left: -10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }

    .lever-base {
      width: 70px;
      height: 12px;
      background: #222;
      border-radius: 4px;
      margin-top: 5px;
    }

    .lever.pulled {
      transform: rotate(-25deg);
      transform-origin: bottom center;
    }

    .rolls-counter {
      background: var(--space-light);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 1rem;
      border: 2px solid var(--space-accent); 
      min-width: 150px;
      text-align: center;
      top: 100px;
      left: 450px;
      position: absolute;
      z-index: 1;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(138, 106, 205, 0.2);
    }

    .dice-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      width: 100%;
      justify-content: center;
      flex-direction: column;
      align-items: center;
    }

    .table-container {
      flex: 1;
      overflow: auto;
      background: var(--space-gray);
      border-radius: 8px;
      padding: 10px;
      border: 2px solid var(--space-accent); 
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .table-container::-webkit-scrollbar {
      width: 8px;
    }

    .table-container::-webkit-scrollbar-track {
      background: var(--space-dark);
    }

    .table-container::-webkit-scrollbar-thumb {
      background: var(--space-accent);
      border-radius: 4px;
    }

    .game-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .game-table th,
    .game-table td {
      padding: 15px 5px;
      text-align: center;
      border: 1px solid var(--space-border);
      font-size: 0.8rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .game-table th {
      background: var(--space-light);
      position: sticky;
      top: 0;
      color: var(--space-text);
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }

    .game-table td {
      background: rgba(30, 30, 30, 0.8);
      color: var(--space-text);
    }

    .game-table td input {
      width: 100%;
      background: transparent;
      border: none;
      color: white;
      text-align: center;
      font-size: 0.8rem;
      outline: none;
    }

    .available-cell {
      background-color: var(--space-purple-light) !important; 
      cursor: pointer;
    }

    .available-cell:hover {
      background-color: rgba(138, 106, 205, 0.3) !important; 
    }

 
    .player-column-highlight {
      background: var(--space-purple-light) !important; 
      box-shadow: inset 0 0 10px rgba(138, 106, 205, 0.3); 
    }

 
    .menu-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }

    .menu-btn {
      background: linear-gradient(to bottom, #333, #222);
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--space-border);
    }

    .menu-btn:hover {
      background: linear-gradient(to bottom, var(--space-accent), #6a4acd);
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--space-gray);
      min-width: 220px;
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      z-index: 100;
      border: 2px solid var(--space-accent); 
      padding: 10px;
    }

    .dropdown-menu.show {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-menu button {
      width: 100%;
      text-align: left;
      padding: 12px 15px;
      background: transparent;
      border: none;
      color: var(--space-text);
      cursor: pointer;
      border-radius: 5px;
      margin: 5px 0;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .dropdown-menu button:hover {
      background: rgba(138, 106, 205, 0.2); 
    }

    .dropdown-menu button i {
      font-size: 1.2rem;
      min-width: 24px;
      text-align: center;
      color: var(--space-accent); 
    }

 
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--space-gray);
      border-radius: 10px;
      padding: 30px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 3px solid var(--space-accent); 
      box-shadow: 0 0 30px rgba(138, 106, 205, 0.4); 
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--space-accent); 
      padding-bottom: 10px;
    }

    .modal-title {
      font-size: 1.8rem;
      color: var(--space-accent); 
      text-shadow: 0 0 10px rgba(138, 106, 205, 0.5); 
    }

    .close-modal {
      background: none;
      border: none;
      color: var(--space-text);
      font-size: 2rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-modal:hover {
      color: var(--space-accent); 
    }

    .rules-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .rule-item {
      background: var(--space-dark);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid var(--space-border);
    }

    .rule-title {
      color: var(--space-accent);
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .players-setup {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
      padding: 15px;
      background: rgba(30, 30, 30, 0.7);
      border-radius: 8px;
      border: 2px solid var(--space-accent); 
    }

    .player-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .player-input {
      flex: 1;
      padding: 10px;
      background: var(--space-dark);
      border: 1px solid var(--space-accent); 
      border-radius: 5px;
      color: white;
      font-size: 0.9rem;
    }

    .add-player-btn,
    .remove-player-btn {
      background: var(--space-light);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
    }

    .add-player-btn:hover,
    .remove-player-btn:hover {
      background: var(--space-accent); 
      color: black;
    }

    .calculator-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--space-gray);
      padding: 15px;
      border-radius: 8px;
      border: 2px solid var(--space-accent); 
      box-shadow: 0 0 20px rgba(138, 106, 205, 0.4); 
      z-index: 100;
      width: 260px;
    }

    .calculator-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .calculator-title {
      font-size: 1.2rem;
      color: var(--space-accent); 
      text-shadow: 0 0 5px rgba(138, 106, 205, 0.5); 
    }

    .close-calculator {
      background: none;
      border: none;
      color: var(--space-text);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-calculator:hover {
      color: var(--space-accent); 
    }

    .calculator-display {
      background: var(--space-dark);
      color: white;
      padding: 10px;
      text-align: right;
      margin-bottom: 10px;
      border-radius: 5px;
      font-size: 1.5rem;
      height: 50px;
      border: 1px solid var(--space-border);
    }

    .calculator-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
    }

    .calc-btn {
      background: var(--space-light);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.2s;
    }

    .calc-btn:hover {
      background: var(--space-accent); 
      color: black;
    }

    @media (max-width: 1200px) {
      .rules-content {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .start-container {
        flex-direction: column;
      }

      .game-title {
        font-size: 2.5rem;
      }

      .dice-wrapper {
        width: 60px;
        height: 60px;
      }

      .face {
        transform: translateZ(30px) !important;
      }

      .face::before {
        width: 12px;
        height: 12px;
      }

      .dice-row {
        gap: 15px;
      }

      .menu-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
      }

      .dropdown-menu {
        min-width: 200px;
      }

      .lever {
        width: 40px;
        height: 100px;
      }

      .lever-handle {
        width: 60px;
        left: -10px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
  <div id="starfield"></div>
  <div id="startScreen">
    <h1 class="game-title">КОСМИЧЕСКИЙ ПОКЕР</h1>

    <div class="start-container">
      <div class="start-panel">
        <div class="cat-container">
          <img src="cat (3).png" alt="Космический кот" class="cat-image">
        </div>
        <button class="btn" id="knowRulesBtn">Я ЗНАЮ ПРАВИЛА</button>
        <button class="btn" id="learnRulesBtn">ОБУЧИТЬ МЕНЯ</button>
      </div>

      <div class="start-panel">
        <h2 style="margin-bottom: 20px; color: var(--space-accent);">ПОКЕР В КОСМОСЕ</h2>
        <p style="margin-bottom: 20px; line-height: 1.6;">
          Добро пожаловать в захватывающую космическую версию игры в покер!<br>
          Сражайтесь с друзьями на просторах галактики, используйте специальные режимы и подсказки.
        </p>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="color: var(--space-accent); font-size: 1.5rem;">★</span>
            <span>Упрощенный и лаконичный интерфейс</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="color: var(--space-accent); font-size: 1.5rem;">★</span>
            <span>Сдержанная цветовая палитра</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="color: var(--space-accent); font-size: 1.5rem;">★</span>
            <span>Все функции в удобном меню</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="color: var(--space-accent); font-size: 1.5rem;">★</span>
            <span>Быстрый старт для знатоков</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="gameScreen">
    <div class="timer-container">
      <div>ТАЙМЕР:</div>
      <div id="timer">30</div>
    </div>
    <div class="menu-container">
      <button class="menu-btn" id="menuBtn">
        <i class="fas fa-bars"></i> МЕНЮ
      </button>
      <div class="dropdown-menu" id="dropdownMenu">
        <button id="showRulesBtn"><i class="fas fa-book"></i> ПРАВИЛА</button>
        <button id="newGameBtn"><i class="fas fa-plus-circle"></i> НОВАЯ ИГРА</button>
        <button id="toggleTimerBtn"><i class="fas fa-clock"></i> ТАЙМЕР: ВЫКЛ</button>
        <button id="calculatorBtn"><i class="fas fa-calculator"></i> КАЛЬКУЛЯТОР</button>
        <button id="modesBtn"><i class="fas fa-cogs"></i> РЕЖИМЫ</button>
        <button id="hintsBtn"><i class="fas fa-lightbulb"></i> ПОДСКАЗКИ: ВЫКЛ</button>
      </div>
    </div>

    <div class="game-content">
      <div class="dice-area">
        <h3>КУБИКИ</h3>
        <div class="dice-row">
          <!-- Кубик 1 -->
          <div class="dice-wrapper" data-index="0">
            <div class="dice" id="dice1">
              <div class="face front" data-value="1"></div>
              <div class="face back" data-value="2"></div>
              <div class="face right" data-value="3"></div>
              <div class="face left" data-value="4"></div>
              <div class="face top" data-value="5"></div>
              <div class="face bottom" data-value="6"></div>
            </div>
          </div>

          <!-- Кубик 2 -->
          <div class="dice-wrapper" data-index="1">
            <div class="dice" id="dice2">
              <div class="face front" data-value="1"></div>
              <div class="face back" data-value="2"></div>
              <div class="face right" data-value="3"></div>
              <div class="face left" data-value="4"></div>
              <div class="face top" data-value="5"></div>
              <div class="face bottom" data-value="6"></div>
            </div>
          </div>

          <!-- Кубик 3 -->
          <div class="dice-wrapper" data-index="2">
            <div class="dice" id="dice3">
              <div class="face front" data-value="1"></div>
              <div class="face back" data-value="2"></div>
              <div class="face right" data-value="3"></div>
              <div class="face left" data-value="4"></div>
              <div class="face top" data-value="5"></div>
              <div class="face bottom" data-value="6"></div>
            </div>
          </div>

          <!-- Кубик 4 -->
          <div class="dice-wrapper" data-index="3">
            <div class="dice" id="dice4">
              <div class="face front" data-value="1"></div>
              <div class="face back" data-value="2"></div>
              <div class="face right" data-value="3"></div>
              <div class="face left" data-value="4"></div>
              <div class="face top" data-value="5"></div>
              <div class="face bottom" data-value="6"></div>
            </div>
          </div>

          <!-- Кубик 5 -->
          <div class="dice-wrapper" data-index="4">
            <div class="dice" id="dice5">
              <div class="face front" data-value="1"></div>
              <div class="face back" data-value="2"></div>
              <div class="face right" data-value="3"></div>
              <div class="face left" data-value="4"></div>
              <div class="face top" data-value="5"></div>
              <div class="face bottom" data-value="6"></div>
            </div>
          </div>
        </div>

        <div class="lever-container">
          <div class="lever" id="lever">
            <div class="lever-handle"></div>
          </div>
          <div class="rolls-counter">Бросков: <span id="rollsCounter">3</span></div>
        </div>

        <div class="dice-controls">
        </div>
      </div>

      <div class="table-container">
        <table class="game-table" id="scoreTable">
        </table>
      </div>
    </div>


    <div class="calculator-popup" id="calculatorPopup">
      <div class="calculator-header">
        <div class="calculator-title">КАЛЬКУЛЯТОР</div>
        <button class="close-calculator" id="closeCalculator">&times;</button>
      </div>
      <div class="calculator-display" id="calcDisplay">0</div>
      <div class="calculator-buttons">
        <button class="calc-btn">7</button>
        <button class="calc-btn">8</button>
        <button class="calc-btn">9</button>
        <button class="calc-btn">/</button>
        <button class="calc-btn">4</button>
        <button class="calc-btn">5</button>
        <button class="calc-btn">6</button>
        <button class="calc-btn">*</button>
        <button class="calc-btn">1</button>
        <button class="calc-btn">2</button>
        <button class="calc-btn">3</button>
        <button class="calc-btn">-</button>
        <button class="calc-btn">0</button>
        <button class="calc-btn">.</button>
        <button class="calc-btn">=</button>
        <button class="calc-btn">+</button>
        <button class="calc-btn" style="grid-column: span 2;">C</button>
        <button class="calc-btn" style="grid-column: span 2;">CE</button>
      </div>
    </div>
  </div>


  <div class="modal" id="rulesModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">ПРАВИЛА КОСМИЧЕСКОГО ПОКЕРА</h2>
        <button class="close-modal">&times;</button>
      </div>

      <div class="rules-content">
        <div>
          <div class="rule-item">
            <div class="rule-title">ОСНОВЫ ИГРЫ</div>
            <div>Цель игры - набрать максимальное количество очков, составляя комбинации из 5 кубиков.</div>
          </div>

          <div class="rule-item">
            <div class="rule-title">ХОД ИГРЫ</div>
            <div>Каждый игрок делает до 3 бросков кубиков за ход, выбирая какие кубики оставить.</div>
          </div>

          <div class="rule-item">
            <div class="rule-title">ПОДСЧЕТ ОЧКОВ</div>
            <div>
              <div>• Школа: специальные правила для каждой цифры</div>
              <div>• Пара: сумма двух одинаковых кубиков</div>
              <div>• Две пары: сумма двух пар</div>
              <div>• Треугольник: сумма трех одинаковых</div>
              <div>• Квадрат: сумма четырех одинаковых</div>
              <div>• Фулл-хаус: 25 очков</div>
              <div>• Лестница: 25 очков (1-5 или 2-6)</div>
              <div>• Покер: 100 очков за все 1, 200 за все 2 и т.д.</div>
            </div>
          </div>
        </div>

        <div>
          <div class="rule-item">
            <div class="rule-title">ОСОБЫЕ ПРАВИЛА ШКОЛЫ</div>
            <div>
              <div>• Поставьте "X" чтобы закрыть школу</div>
              <div>• Введите число для очков (например, +20 или -10)</div>
              <div>• Школа закрывается после ввода "X"</div>
            </div>
          </div>

          <div class="rule-item">
            <div class="rule-title">ШТРАФЫ</div>
            <div>
              <div>• За каждую незаполненную ячейку школы: -5 очков</div>
            </div>
          </div>

          <div class="rule-item">
            <div class="rule-title">РЕЖИМЫ</div>
            <div>• Подсказки: показывают лучшие ходы<br>
              • Автоподсчет: автоматически считает очки<br>
              • Команды: игра в командах<br>
              • Случайные события: бонусы и штрафы</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Модальное окно выбора режимов -->
  <div class="modal" id="modesModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">ВЫБОР РЕЖИМОВ ИГРЫ</h2>
        <button class="close-modal">&times;</button>
      </div>

      <div class="mode-description">
        <h3>Доступные режимы:</h3>
        <p>Вы можете комбинировать некоторые режимы для создания уникального игрового опыта.</p>
      </div>

      <div class="modes-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
        <div style="background: var(--space-dark); padding: 15px; border-radius: 8px; border: 1px solid var(--space-border);">
          <h4>Подсказки</h4>
          <p>Получайте советы по оптимальным ходам</p>
          <button class="mode-btn btn" data-mode="hints" style="margin-top: 10px;">Выбрать</button>
        </div>

        <div style="background: var(--space-dark); padding: 15px; border-radius: 8px; border: 1px solid var(--space-border);">
          <h4>Автоподсчет</h4>
          <p>Автоматический подсчет очков</p>
          <button class="mode-btn btn" data-mode="autocalc" style="margin-top: 10px;">Выбрать</button>
        </div>

        <div style="background: var(--space-dark); padding: 15px; border-radius: 8px; border: 1px solid var(--space-border);">
          <h4>Команды</h4>
          <p>Играйте в командах по 2 человека</p>
          <button class="mode-btn btn" data-mode="teams" style="margin-top: 10px;">Выбрать</button>
        </div>

        <div style="background: var(--space-dark); padding: 15px; border-radius: 8px; border: 1px solid var(--space-border);">
          <h4>Случайные события</h4>
          <p>Неожиданные бонусы и штрафы</p>
          <button class="mode-btn btn" data-mode="random" style="margin-top: 10px;">Выбрать</button>
        </div>
      </div>

      <div style="margin-top: 20px; display: flex; justify-content: center;">
        <button class="btn" id="nextToPlayersBtn">ДАЛЕЕ</button>
      </div>
    </div>
  </div>

  <!-- Модальное окно добавления игроков -->
  <div class="modal" id="playersModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">ДОБАВЛЕНИЕ ИГРОКОВ</h2>
        <button class="close-modal">&times;</button>
      </div>

      <!-- Форма добавления игроков -->
      <div class="players-setup">
        <h3>ДОБАВЬТЕ ИГРОКОВ (МАКС. 15)</h3>
        <div id="playersList">
          <div class="player-input-group">
            <input type="text" class="player-input" placeholder="Имя игрока" value="Игрок 1">
            <button class="remove-player-btn" disabled>-</button>
          </div>
          <div class="player-input-group">
            <input type="text" class="player-input" placeholder="Имя игрока" value="Игрок 2">
            <button class="remove-player-btn">-</button>
          </div>
        </div>
        <button class="add-player-btn" id="addPlayerBtn">+ </button>
      </div>

      <div style="margin-top: 20px; display: flex; justify-content: center;">
        <button class="btn" id="startGameBtn">НАЧАТЬ ИГРУ</button>
      </div>
    </div>
  </div>

  <script>
    // Состояние игры
    const gameState = {
      currentPlayer: 0,
      players: [],
      teams: [],
      diceValues: [1, 2, 3, 4, 5],
      heldDice: [false, false, false, false, false],
      rollsLeft: 3,
      timer: 30,
      timerInterval: null,
      activeModes: new Set(),
      gameStarted: false,
      teamMode: false,
      timerEnabled: false,
      hintsEnabled: false,
      scores: {},
      schoolBonuses: {},
      selectedCell: null,
      isRolling: false
    };

    // Элементы интерфейса
    const elements = {
      startScreen: document.getElementById('startScreen'),
      gameScreen: document.getElementById('gameScreen'),
      rulesModal: document.getElementById('rulesModal'),
      modesModal: document.getElementById('modesModal'),
      playersModal: document.getElementById('playersModal'),
      timer: document.getElementById('timer'),
      scoreTable: document.getElementById('scoreTable'),
      playersList: document.getElementById('playersList'),
      addPlayerBtn: document.getElementById('addPlayerBtn'),
      calculatorPopup: document.getElementById('calculatorPopup'),
      calculatorBtn: document.getElementById('calculatorBtn'),
      closeCalculator: document.getElementById('closeCalculator'),
      calcDisplay: document.getElementById('calcDisplay'),
      menuBtn: document.getElementById('menuBtn'),
      dropdownMenu: document.getElementById('dropdownMenu'),
      toggleTimerBtn: document.getElementById('toggleTimerBtn'),
      modesBtn: document.getElementById('modesBtn'),
      hintsBtn: document.getElementById('hintsBtn'),
      lever: document.getElementById('lever'),
      rollsCounter: document.getElementById('rollsCounter'),
      diceElements: [
        document.getElementById('dice1'),
        document.getElementById('dice2'),
        document.getElementById('dice3'),
        document.getElementById('dice4'),
        document.getElementById('dice5')
      ]
    };

    // Инициализация игры
    function initGame() {
      createStarfield();

      // Обработчики кнопок
      document.getElementById('knowRulesBtn').addEventListener('click', () => {
        showModal(elements.playersModal);
      });

      document.getElementById('learnRulesBtn').addEventListener('click', () => {
        showModal(elements.rulesModal);
      });

      document.getElementById('showRulesBtn').addEventListener('click', () => {
        showModal(elements.rulesModal);
      });

      document.getElementById('newGameBtn').addEventListener('click', resetGame);
      document.getElementById('nextToPlayersBtn').addEventListener('click', () => {
        showModal(elements.playersModal);
      });
      document.getElementById('startGameBtn').addEventListener('click', startGame);

      // Обработчики меню
      elements.menuBtn.addEventListener('click', toggleMenu);
      document.addEventListener('click', closeMenuOnClickOutside);

      // Обработчики закрытия модальных окон
      document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
          });
        });
      });

      // Обработчики кубиков
      document.querySelectorAll('.dice-wrapper').forEach((wrapper, index) => {
        wrapper.addEventListener('click', () => toggleHoldDice(index));
      });

      // Обработчик броска кубиков
      elements.lever.addEventListener('click', rollDice);

      // Обработчики режимов
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => toggleGameMode(btn.dataset.mode));
      });

      // Обработчики для добавления/удаления игроков
      elements.addPlayerBtn.addEventListener('click', addPlayer);

      // Инициализация обработчиков удаления игроков
      initRemovePlayerButtons();

      // Обработчики калькулятора
      document.querySelectorAll('.calc-btn').forEach(btn => {
        btn.addEventListener('click', handleCalculatorInput);
      });

      // Переключение таймера
      elements.toggleTimerBtn.addEventListener('click', toggleTimer);

      // Переключение калькулятора
      elements.calculatorBtn.addEventListener('click', toggleCalculator);

      // Закрытие калькулятора
      elements.closeCalculator.addEventListener('click', toggleCalculator);

      // Переключение режима подсказок
      elements.hintsBtn.addEventListener('click', toggleHints);

      // Переключение режимов
      elements.modesBtn.addEventListener('click', () => {
        showModal(elements.modesModal);
      });
    }

    // Переключение меню
    function toggleMenu() {
      elements.dropdownMenu.classList.toggle('show');
    }

    // Закрытие меню при клике вне его
    function closeMenuOnClickOutside(event) {
      if (!elements.menuBtn.contains(event.target) &&
        !elements.dropdownMenu.contains(event.target)) {
        elements.dropdownMenu.classList.remove('show');
      }
    }

    // Переключение калькулятора
    function toggleCalculator() {
      elements.calculatorPopup.style.display =
        elements.calculatorPopup.style.display === 'block' ? 'none' : 'block';
    }

    // Переключение таймера
    function toggleTimer() {
      gameState.timerEnabled = !gameState.timerEnabled;
      elements.toggleTimerBtn.innerHTML = `<i class="fas fa-clock"></i> ТАЙМЕР: ${gameState.timerEnabled ? 'ВКЛ' : 'ВЫКЛ'}`;

      // Показываем/скрываем контейнер таймера
      document.querySelector('.timer-container').style.display =
        gameState.timerEnabled ? 'flex' : 'none';
    }

    // Переключение подсказок
    function toggleHints() {
      gameState.hintsEnabled = !gameState.hintsEnabled;
      elements.hintsBtn.innerHTML = `<i class="fas fa-lightbulb"></i> ПОДСКАЗКИ: ${gameState.hintsEnabled ? 'ВКЛ' : 'ВЫКЛ'}`;
    }

    // Создание звездного неба
    function createStarfield() {
      const starfield = document.getElementById('starfield');
      if (!starfield) return;

      const starCount = 200;

      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';

        // Случайные размеры и позиции
        const size = Math.random() * 3;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;

        // Случайная анимация
        star.style.setProperty('--duration', `${5 + Math.random() * 10}s`);

        starfield.appendChild(star);
      }
    }

    // Установка значения на кубике
    function setDiceFace(diceElement, value) {
      let transform = '';
      switch (value) {
        case 1: transform = 'rotateX(0) rotateY(0) rotateZ(0)'; break;
        case 2: transform = 'rotateY(180deg)'; break;
        case 3: transform = 'rotateY(90deg)'; break;
        case 4: transform = 'rotateY(-90deg)'; break;
        case 5: transform = 'rotateX(90deg)'; break;
        case 6: transform = 'rotateX(-90deg)'; break;
      }
      diceElement.style.transform = transform;
    }

    function rollDiceElement(diceElement, index) {
      return new Promise((resolve) => {
        if (gameState.heldDice[index]) {
          // Подрагивание для удержанных кубиков
          diceElement.animate([
            { transform: 'translateY(0px) rotate(0deg)' },
            { transform: 'translateY(-2px) rotate(1deg)' },
            { transform: 'translateY(0px) rotate(0deg)' }
          ], {
            duration: 300,
            easing: 'ease-in-out'
          });
          setTimeout(resolve, 300);
          return;
        }

        // Уникальное имя для ключевых кадров
        const animationName = `dice-roll-${Date.now()}-${Math.floor(Math.random() * 10000)}`;

        // Генерируем случайное число оборотов по каждой оси
        const xRotations = 3 + Math.floor(Math.random() * 4); // 3–6 оборотов
        const yRotations = 2 + Math.floor(Math.random() * 3); // 2–4 оборота
        const zRotations = 1 + Math.floor(Math.random() * 2); // 1–2 оборота

        // Создаем CSS ключевые кадры
        const keyframes = `
          @keyframes ${animationName} {
            0% {
              transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
            }
            100% {
              transform: rotateX(${xRotations * 360}deg) rotateY(${yRotations * 360}deg) rotateZ(${zRotations * 360}deg);
            }
          }
        `;

        // Вставляем стили
        const style = document.createElement('style');
        style.textContent = keyframes;
        document.head.appendChild(style);

        // Длительность — случайная от 1.8 до 2.8 секунды
        const duration = 2200 + Math.random() * 1500;

        // Добавляем анимацию
        diceElement.style.animation = `${animationName} ${duration}ms ease-out forwards`;

        // После завершения анимации
        setTimeout(() => {
          // Удаляем стили
          document.head.removeChild(style);

          // Сбрасываем анимацию
          diceElement.style.animation = 'none';

          // Устанавливаем финальное положение — нужная грань
          setDiceFace(diceElement, gameState.diceValues[index]);

          // Плавный переход в финальное положение (если нужно визуально скорректировать)
          diceElement.style.transition = 'transform 0.8s cubic-bezier(0.15, 0.85, 0.25, 1)';

          // Завершение
          setTimeout(resolve, 100);
        }, duration);
      });
    }

    // Бросить кубики
    function rollDice() {
      if (gameState.rollsLeft <= 0 || gameState.isRolling) return;

      gameState.isRolling = true;

      // Анимация рычага
      elements.lever.classList.add('pulled');
      setTimeout(() => {
        elements.lever.classList.remove('pulled');
      }, 500);

      // Генерируем новые значения для не удержанных кубиков
      for (let i = 0; i < 5; i++) {
        if (!gameState.heldDice[i]) {
          gameState.diceValues[i] = Math.floor(Math.random() * 6) + 1;
        }
      }

      // Запуск анимации для всех кубиков
      const rollPromises = elements.diceElements.map((dice, index) =>
        rollDiceElement(dice, index)
      );

      Promise.all(rollPromises).then(() => {
        gameState.rollsLeft--;
        elements.rollsCounter.textContent = gameState.rollsLeft;

        // Обновление состояния
        gameState.isRolling = false;

        // Если бросков больше не осталось
        if (gameState.rollsLeft === 0) {
          updateScoreTable();
        }
      });
    }

    // Переключить удержание кубика
    function toggleHoldDice(index) {
      if (gameState.isRolling) return;

      gameState.heldDice[index] = !gameState.heldDice[index];
      const dice = document.querySelectorAll('.dice-wrapper')[index].querySelector('.dice');
      dice.classList.toggle('held', gameState.heldDice[index]);
    }

    // Добавление игрока
    function addPlayer() {
      if (gameState.players.length >= 15) {
        alert('Максимальное количество игроков - 15');
        return;
      }

      const playerNum = gameState.players.length + 1;
      const newPlayer = {
        name: `Игрок ${playerNum}`,
        score: 0,
        team: playerNum % 2
      };

      gameState.players.push(newPlayer);

      // Добавление строки ввода в форму
      const playerInputGroup = document.createElement('div');
      playerInputGroup.className = 'player-input-group';
      playerInputGroup.innerHTML = `
        <input type="text" class="player-input" placeholder="Имя игрока" value="${newPlayer.name}">
        <button class="remove-player-btn">-</button>
      `;

      elements.playersList.appendChild(playerInputGroup);

      // Добавление обработчика для новой кнопки удаления
      const removeBtn = playerInputGroup.querySelector('.remove-player-btn');
      removeBtn.addEventListener('click', function () {
        const index = Array.from(elements.playersList.children).indexOf(playerInputGroup);
        if (gameState.players.length > 2) {
          gameState.players.splice(index, 1);
          elements.playersList.removeChild(playerInputGroup);
        } else {
          alert('Должно быть не менее 2 игроков');
        }
      });
    }

    // Инициализация кнопок удаления игроков
    function initRemovePlayerButtons() {
      document.querySelectorAll('.remove-player-btn').forEach((btn, index) => {
        if (index === 0) {
          btn.disabled = true;
        }

        btn.addEventListener('click', function () {
          const playerInputGroup = this.parentElement;
          const index = Array.from(elements.playersList.children).indexOf(playerInputGroup);

          if (gameState.players.length > 2) {
            gameState.players.splice(index, 1);
            elements.playersList.removeChild(playerInputGroup);
          } else {
            alert('Должно быть не менее 2 игроков');
          }
        });
      });
    }

    // Обновление таблицы очков
    function updateScoreTable() {
      const categories = [
        { id: 'ones', name: '1', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'twos', name: '2', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'threes', name: '3', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'fours', name: '4', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'fives', name: '5', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'sixes', name: '6', style: 'background-color: rgba(50, 50, 50, 0.5);' },
        { id: 'schoolSum', name: 'Школа', style: 'background-color: rgba(70, 70, 70, 0.5); font-weight: bold;' },
        { id: 'pair', name: '1 Пара', style: 'background-color: rgba(70, 70, 70, 0.5);' },
        { id: 'twoPairs', name: '2 Пары', style: 'background-color: rgba(70, 70, 70, 0.5);' },
        { id: 'threeOfAKind', name: 'Треугольник', style: 'background-color: rgba(70, 70, 70, 0.5);' },
        { id: 'fourOfAKind', name: 'Квадрат', style: 'background-color: rgba(70, 70, 70, 0.5);' },
        { id: 'straight', name: 'Лестница', style: 'background-color: rgba(100, 100, 100, 0.5);' },
        { id: 'fullHouse', name: 'Фулл-хаус', style: 'background-color: rgba(100, 100, 100, 0.5);' },
        { id: 'poker', name: 'Покер', style: 'background-color: rgba(100, 100, 100, 0.5);' },
        { id: 'grandTotal', name: 'Гранд Итого', style: 'background-color: rgba(150, 150, 150, 0.3); font-weight: bold;' }
      ];

      let tableHTML = `
        <thead>
          <tr>
            <th>Категория</th>
      `;

      // Заголовки столбцов для игроков
      gameState.players.forEach((player, index) => {
        tableHTML += `<th class="${index === gameState.currentPlayer ? 'player-column-highlight' : ''}">${player.name}</th>`;
      });

      tableHTML += `</tr></thead><tbody>`;

      categories.forEach(category => {
        tableHTML += `<tr><td style="${category.style}">${category.name}</td>`;
        gameState.players.forEach((player, playerIndex) => {
          let value = '';
          let cellClass = playerIndex === gameState.currentPlayer ? 'player-column-highlight' : '';

          if (category.id === 'schoolSum') {
            const schoolCats = ['ones','twos','threes','fours','fives','sixes'];
            let sum = 0;
            schoolCats.forEach(cat => {
              const v = gameState.scores[playerIndex][cat];
              if (typeof v === 'string' && (v.startsWith('+') || v.startsWith('-'))) {
                sum += Number(v);
              } else if (typeof v === 'number') {
                sum += v;
              }
            });
            value = (sum > 0 ? '+' + sum : sum === 0 ? '0' : String(sum));
          }
          else if (category.id === 'grandTotal') {
            // Проверяем, заполнены ли все категории
            const allCategories = ['ones', 'twos', 'threes', 'fours', 'fives', 'sixes', 'pair', 'twoPairs', 'threeOfAKind', 'fourOfAKind', 'straight', 'fullHouse', 'poker'];
            const playerScores = gameState.scores[playerIndex];
            const allFilled = allCategories.every(cat => playerScores[cat] !== null);

            value = allFilled ? gameState.players[playerIndex].score : '';
          } else {
            // Обычная категория
            const score = gameState.scores[playerIndex]?.[category.id] ?? null;
            value = score !== null ? score : '';

            // Если текущий игрок и категория доступна для выбора
            if (playerIndex === gameState.currentPlayer &&
              gameState.rollsLeft === 0 &&
              score === null) {
              cellClass += ' available-cell';
            }
          }

          tableHTML += `<td class="${cellClass}" data-category="${category.id}" data-player="${playerIndex}">${value}</td>`;
        });

        tableHTML += `</tr>`;
      });

      tableHTML += `</tbody>`;

      elements.scoreTable.innerHTML = tableHTML;

      // Добавляем обработчики для ввода значений
      document.querySelectorAll('.available-cell').forEach(cell => {
        cell.addEventListener('dblclick', () => {
          const category = cell.dataset.category;
          const playerIndex = parseInt(cell.dataset.player);
          const currentValue = gameState.scores[playerIndex]?.[category] ?? '';

          cell.innerHTML = `<input type="text" class="cell-input" value="${currentValue}" 
            data-category="${category}" data-player="${playerIndex}">`;

          const input = cell.querySelector('.cell-input');
          input.focus();

          input.addEventListener('blur', saveCellValue);
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              saveCellValue.call(input);
            }
          });
        });
      });
    }

    // Сохранение значения ячейки
    function saveCellValue() {
      const input = this;
      const value = input.value.trim();
      const category = input.dataset.category;
      const playerIndex = parseInt(input.dataset.player);

      // Обработка значения
      if (value.toUpperCase() === 'X') {
        gameState.scores[playerIndex][category] = 'X';
      } else if (!isNaN(value) || value.startsWith('+') || value.startsWith('-')) {
        // Пробуем преобразовать в число, учитывая знаки +/-
        let numericValue = value;
        if (value.startsWith('+')) {
          numericValue = value.substring(1);
        }
        gameState.scores[playerIndex][category] = isNaN(numericValue) ? 0 : Number(numericValue);
      } else {
        gameState.scores[playerIndex][category] = 0;
      }

      // Пересчет общего счета
      calculatePlayerScore(playerIndex);

      // Обновление таблицы
      updateScoreTable();

      // Переход к следующему игроку после выбора категории
      endPlayerTurn();
    }

    // Подсчет общего счета игрока
    function calculatePlayerScore(playerIndex) {
      let total = 0;
      let schoolSum = 0;
      let schoolComplete = true;

      // Школа (1-6)
      const schoolCategories = ['ones', 'twos', 'threes', 'fours', 'fives', 'sixes'];
      schoolCategories.forEach(category => {
        const score = gameState.scores[playerIndex][category];

        if (score === null) {
          schoolComplete = false;
          total -= 5; // Штраф за незаполненную ячейку школы
        } else if (typeof score === 'number') {
          schoolSum += score;
        }
      });

      // Бонус за школу (если сумма >= 63)
      if (schoolComplete && schoolSum >= 63) {
        total += 35; // Бонус за заполненную школу
      }

      // Остальные категории
      const otherCategories = ['pair', 'twoPairs', 'threeOfAKind', 'fourOfAKind', 'straight', 'fullHouse', 'poker'];
      otherCategories.forEach(category => {
        const score = gameState.scores[playerIndex][category];
        if (score !== null && typeof score === 'number') {
          total += score;
        }
      });

      gameState.players[playerIndex].score = total;
    }

    // Показать модальное окно
    function showModal(modal) {
      document.querySelectorAll('.modal').forEach(m => {
        m.style.display = 'none';
      });
      modal.style.display = 'flex';
    }

    // Переключение режима игры
    function toggleGameMode(mode) {
      const btn = document.querySelector(`.mode-btn[data-mode="${mode}"]`);

      // Проверка на совместимость режимов
      if (mode === 'random' && gameState.activeModes.has('teams')) {
        alert('Режим "Случайные события" несовместим с "Командным" режимом!');
        return;
      }

      if (mode === 'teams') {
        gameState.teamMode = !gameState.teamMode;
        if (gameState.teamMode && gameState.players.length % 2 !== 0) {
          alert('Для командного режима нужно парное количество игроков!');
          gameState.teamMode = false;
          return;
        }
      }

      if (gameState.activeModes.has(mode)) {
        gameState.activeModes.delete(mode);
        btn.classList.remove('active');
      } else {
        gameState.activeModes.add(mode);
        btn.classList.add('active');
      }
    }

    // Начать игру
    function startGame() {
      elements.diceElements = [
        document.getElementById('dice1'),
        document.getElementById('dice2'),
        document.getElementById('dice3'),
        document.getElementById('dice4'),
        document.getElementById('dice5')
      ];
      // Получаем имена игроков из формы
      const playerInputs = document.querySelectorAll('.player-input');
      gameState.players = [];

      playerInputs.forEach((input, index) => {
        const name = input.value.trim() || `Игрок ${index + 1}`;
        gameState.players.push({
          name,
          score: 0,
          team: index % 2
        });
      });

      if (gameState.players.length < 2) {
        alert('Должно быть не менее 2 игроков!');
        return;
      }

      // Инициализируем структуру очков
      initScores();

      elements.startScreen.style.display = 'none';
      elements.gameScreen.style.display = 'block';
      gameState.gameStarted = true;

      // Закрываем модальные окна
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });

      // Обновляем таблицу очков
      updateScoreTable();

      // Запускаем первый ход
      gameState.currentPlayer = 0;
      startPlayerTurn();
    }

    // Инициализация структуры очков
    function initScores() {
      gameState.scores = {};
      gameState.players.forEach((player, playerIndex) => {
        gameState.scores[playerIndex] = {
          ones: null,
          twos: null,
          threes: null,
          fours: null,
          fives: null,
          sixes: null,
          pair: null,
          twoPairs: null,
          threeOfAKind: null,
          fourOfAKind: null,
          straight: null,
          fullHouse: null,
          poker: null
        };
      });
    }

    // Начать ход игрока
    function startPlayerTurn() {
      // Сброс кубиков
      resetDice();

      // Обновляем таблицу очков
      updateScoreTable();

      // Запускаем таймер, если он включен
      if (gameState.timerEnabled) {
        startTimer();
      }
    }

    // Запуск таймера
    function startTimer() {
      clearInterval(gameState.timerInterval);
      gameState.timer = 30;
      elements.timer.textContent = gameState.timer;
      elements.timer.style.color = 'var(--space-accent)';

      gameState.timerInterval = setInterval(() => {
        gameState.timer--;
        elements.timer.textContent = gameState.timer;

        if (gameState.timer <= 0) {
          clearInterval(gameState.timerInterval);
          // Автоматический переход, если время вышло
          endPlayerTurn();
        } else if (gameState.timer <= 10) {
          elements.timer.style.color = '#ff5555';
        }
      }, 1000);
    }

    // Сбросить кубики
    function resetDice() {
      gameState.heldDice = [false, false, false, false, false];
      gameState.rollsLeft = 3;
      gameState.diceValues = [1, 2, 3, 4, 5];

      elements.rollsCounter.textContent = gameState.rollsLeft;

      // Сброс стилей кубиков
      elements.diceElements.forEach((dice, index) => {
        dice.classList.remove('held');
        dice.style.transition = 'transform 0.5s cubic-bezier(0.17, 0.67, 0.83, 0.67)';
        setDiceFace(dice, gameState.diceValues[index]);
      });
    }

    // Завершить ход игрока
    function endPlayerTurn() {
      // Переключаем игрока
      gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;

      // Останавливаем таймер
      clearInterval(gameState.timerInterval);

      // Начинаем следующий ход
      setTimeout(startPlayerTurn, 1000);
    }

    // Сбросить игру
    function resetGame() {
      clearInterval(gameState.timerInterval);

      // Сброс игроков
      gameState.players.forEach(player => player.score = 0);
      updateScoreTable();

      resetDice();

      // Сброс выбранных режимов
      gameState.activeModes.clear();
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      gameState.currentPlayer = 0;
      startPlayerTurn();

      elements.gameScreen.style.display = 'none';
      elements.startScreen.style.display = 'flex';
    }

    // Обработка ввода калькулятора
    function handleCalculatorInput(e) {
      const value = e.target.textContent;
      let display = elements.calcDisplay.textContent;

      if (value === 'C') {
        display = '0';
      } else if (value === 'CE') {
        display = display.length === 1 ? '0' : display.slice(0, -1);
      } else if (value === '=') {
        try {
          display = eval(display).toString();
        } catch {
          display = 'Ошибка';
        }
      } else {
        display = display === '0' ? value : display + value;
      }

      elements.calcDisplay.textContent = display;
    }

    window.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>

</html>
